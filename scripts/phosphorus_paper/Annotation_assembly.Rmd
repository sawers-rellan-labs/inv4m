---
title: "Combined Enrichment Figure Assembly"
author: "Maize Genetics Analysis"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: show
    theme: flatly
knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_dir = here::here("docs", "phosphorus_paper"),
      envir = globalenv()
    )
  })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 16,
  fig.height = 14
)

# Load project paths
library(here)
source(here("scripts", "utils", "setup_paths.R"))
paths <- setup_project_paths("phosphorus_paper")
```

# Overview

**Purpose**: Assemble the final combined enrichment figure with three panels:
- **Panel A**: GO Biological Process enrichment (top)
- **Panel B**: KEGG Pathway enrichment (bottom)
- **Panel C**: LION Lipid enrichment (right)

This script loads pre-generated plots from individual analyses and combines them into a publication-ready figure.

# Libraries
```{r libraries}
library(ggplot2)
library(ggpubr)
library(cowplot)
```

# Load Individual Panels
```{r load_panels}
# Load GO enrichment plot
go_panel <- readRDS(file.path(paths$intermediate, "go_panel.rds"))
cat("Loaded GO panel\n")

# Load KEGG enrichment plot
kegg_panel <- readRDS(file.path(paths$intermediate, "kegg_panel.rds"))
cat("Loaded KEGG panel\n")

# Load LION enrichment plot
lion_panel <- readRDS(file.path(paths$intermediate, "lion_plot.rds"))
cat("Loaded LION panel\n")
```

# Combine Panels

## Option 1: Vertical Stack + Right Panel
```{r combine_vertical_right, fig.width=16, fig.height=16}
# Combine GO and KEGG vertically (left side)
# Increased heights to make bubble plots taller

# Add LION panel to the right
combined_fig_v1 <- ggpubr::ggarrange(
  go_panel,
  kegg_panel,
  lion_panel,
  ncol = 1,
  # widths = c(2, 1),
  labels = c("A", "B","C"),
  font.label =list(size=35)
)

print(combined_fig_v1)
```

# Export Combined Figure
```{r export_combined, eval=FALSE}

# Export as SVG (editable in Illustrator)
ggsave(
  combined_fig_v1,
  filename = file.path(paths$figures, "combined_enrichment_figure.svg"),
  width = 16,
  height = 16,
  units = "in"
)


cat("Exported combined figure in multiple formats\n")
```

# Panel Dimensions Summary
```{r panel_info}
cat("=== Panel Dimensions ===\n\n")
cat("GO Panel:\n")
cat("  Expected: 12 × 8.4 inches (taller)\n\n")

cat("KEGG Panel:\n")
cat("  Expected: 12 × 8.4 inches (taller)\n\n")

cat("LION Panel:\n")
cat("  Expected: 14 × 12 inches\n\n")

cat("Combined Figure (Recommended):\n")
cat("  Layout: Vertical stack (GO + KEGG) + Right panel (LION)\n")
cat("  Dimensions: 16 × 14 inches\n")
cat("  Format: PDF at 150 dpi\n")
```

# Verify Input Data Files
```{r verify_data}
cat("=== Checking Input Data Files ===\n\n")

# Check for plot data CSV files
go_data_exists <- file.exists(file.path(paths$intermediate, "go_plot_input_data.csv"))
kegg_data_exists <- file.exists(file.path(paths$intermediate, "kegg_plot_input_data.csv"))
lion_data_exists <- file.exists(file.path(paths$intermediate, "lion_plot_input_data.csv"))

cat("GO plot data:", ifelse(go_data_exists, "✓ Found", "✗ Missing"), "\n")
cat("KEGG plot data:", ifelse(kegg_data_exists, "✓ Found", "✗ Missing"), "\n")
cat("LION plot data:", ifelse(lion_data_exists, "✓ Found", "✗ Missing"), "\n\n")

if (all(c(go_data_exists, kegg_data_exists, lion_data_exists))) {
  cat("All input data files are available for supplementary materials\n")
} else {
  cat("⚠ Some data files are missing - run individual analysis scripts with eval=TRUE\n")
}
```

# Session Info
```{r session_info}
sessionInfo()
```
